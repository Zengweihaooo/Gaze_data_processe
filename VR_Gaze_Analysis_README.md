# 🎯 VR眼动数据自动分析工具

## 📋 功能介绍

这个工具可以自动分析VR眼动追踪视频，判断用户的视线点是在**现实世界**还是**虚拟游戏世界**中，并生成详细的统计报告。

### ✨ 主要功能
- 🔍 **自动检测**：识别视频中的白色圆形视线点
- 🎨 **区域分析**：分析视线点周围的颜色特征
- 📊 **实时预览**：显示分析过程和结果
- 🚦 **状态指示**：左上角显示状态（绿色=现实，红色=虚拟）
- 📈 **统计报告**：生成详细的CSV数据和分析报告
- ⚙️ **参数调节**：可调节检测阈值和范围

## 🚀 快速开始

### 1. 安装依赖库
```bash
python install_requirements.py
```

### 2. 启动分析工具
```bash
python start_gaze_analysis.py
```

### 3. 选择模式
- **标准模式**：有实时预览，适合单个视频分析
- **批处理模式**：无预览，适合批量处理多个视频
- **调试模式**：可调节参数，适合优化检测效果

## 📁 文件结构

```
项目根目录/
├── gaze_analyzer.py           # 核心分析引擎
├── start_gaze_analysis.py     # 简化启动脚本
├── install_requirements.py    # 依赖安装脚本
├── 眼动数据/                   # 视频文件夹
│   ├── P1_xinyi/
│   ├── P5_guanhua/
│   └── ...
└── analysis_results/          # 分析结果输出
    ├── video_analysis.csv     # 详细数据
    └── video_analyzed.mp4     # 处理后视频
```

## 🎛️ 检测原理

### 视线点检测
1. **圆形检测**：使用HoughCircles算法检测白色圆形
2. **亮度筛选**：选择最亮的圆作为视线点
3. **位置验证**：确保检测点在有效范围内

### 区域分析
1. **颜色阈值**：分析视线点周围指定半径的区域
2. **黑色比例**：计算黑色像素占比
3. **判断逻辑**：
   - 黑色像素 > 50% 或 平均亮度 < 阈值 → **现实世界**
   - 否则 → **虚拟世界**

## ⚙️ 参数调节

### 关键参数
- **black_threshold** (默认30)：黑色检测阈值，越小越严格
- **detection_radius** (默认20)：视线点周围检测半径
- **min_duration** (默认5)：最小持续帧数，避免噪声

### 调节建议
- **视线点检测不准确**：调整圆形检测参数
- **黑色区域误判**：降低black_threshold值
- **切换太频繁**：增加min_duration值
- **检测区域太小**：增加detection_radius值

## 📊 输出结果

### CSV数据格式
| 字段 | 说明 |
|------|------|
| 序号 | 片段编号 |
| 状态 | 现实世界/虚拟世界 |
| 开始帧 | 起始帧号 |
| 结束帧 | 结束帧号 |
| 持续帧数 | 片段长度 |
| 开始时间(秒) | 起始时间 |
| 结束时间(秒) | 结束时间 |
| 持续时间(秒) | 片段时长 |

### 统计报告
- 现实世界片段数量和总时长
- 虚拟世界片段数量和总时长
- 各自占比统计

## 🎮 使用技巧

### 实时预览控制
- **ESC键**：退出预览
- **空格键**：暂停/继续（在某些版本中）

### 批量处理
```bash
python gaze_analyzer.py --input 眼动数据 --output 分析结果 --no-preview
```

### 参数优化
```bash
python gaze_analyzer.py --black-threshold 25 --radius 15
```

## 🔧 故障排除

### 常见问题

**Q: 检测不到视线点？**
A: 检查视频中是否有明显的白色圆形，可能需要调整圆形检测参数

**Q: 黑色区域判断不准确？**
A: 调整black_threshold参数，或检查视频亮度对比度

**Q: 状态切换太频繁？**
A: 增加min_duration参数，过滤短时间的状态切换

**Q: 预览窗口太大？**
A: 程序会自动缩放大于1280像素宽度的视频

### 性能优化
- 对于大视频文件，建议使用批处理模式
- 可以先用小片段测试参数，再处理完整视频
- 关闭预览可以显著提高处理速度

## 📝 更新日志

### v1.0.0
- 基础功能实现
- 自动视线点检测
- 区域颜色分析
- 实时预览和统计报告

## 🤝 技术支持

如果遇到问题或需要功能改进，请提供：
1. 视频文件的基本信息（分辨率、帧率等）
2. 错误信息截图
3. 期望的检测效果描述

---

**祝你的VR眼动研究项目顺利！** 🎉
